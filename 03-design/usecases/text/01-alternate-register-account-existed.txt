@startuml
title Register - Account Exists

actor "User" as us
boundary "Web Browser" as w
boundary "__:newView: View__" as view
boundary "__:DispatchServlet__" as d
entity "__m: Model__" as m
control ": __:AccountSystem__" as accountSys
participant ": __AccountService__" as accountSer
participant ": __UserRepository__" as userRepo
participant ": __AdminRepository__" as adminRepo
participant ": __OrganizerRepository__" as organizerRepo


== 1. The user clicks the "Sign Up" button on the login page ==
us -> w: "click Sign Up"
activate w
w -> d: POST/SignUp(url: String, data:JSON)
activate d
d -> accountSys: signUp(username: String, password: String, email: String, type: accountType, m:Model)
activate accountSys

== 2. The system checks if the account already exists ==
accountSys -> accountSer: getAccount(email, accountType)
activate accountSer

alt Account type is User
    accountSer -> userRepo: null:=findByEmail(email)

else Account type is Admin
    accountSer -> adminRepo: null:=findByEmail(email)

else Account type is Organizer
    accountSer -> organizerRepo: null:=findByEmail(email)
end

accountSer --> accountSys: return Error.emailExisting
deactivate accountSer

== 3. The system displays an error message indicating that the account already exists ==

    accountSys -> m: addAttribute("errorMessage": String, "Account already exists": errorMessage)
    
    accountSys --> d: renturn account creation page
    deactivate accountSys
    create  view
    d -> view: View(m: Model)

    view --> d:
    d --> w: return newView
    deactivate d


== 4. The system returns to the account creation page ==
@enduml